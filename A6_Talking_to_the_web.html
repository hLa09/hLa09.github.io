<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1.0" />

    <title>Ha La's HCDE 439 Physical Computing Page!</title>

    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <h1 class="title">Assignment 6: Talking to the Web!</h1>

    <div class="block">
      <figure>
        <img src="A6_Circuit_sideview.jpg" width="300" height="300"/>
        <figcaption> Fig 1: This image is show in side-view of what the circuit board for the Talking to the Web project. The circuit board has five LEDs: red, yellow, white, blue, and green. With five resistors, and five colored wires connecting to Arduino pin, along with six black wires connect to ground. Another component connect to the Arduino is the joystick, which has four wires connect to the Arduino: one for power (5V), one fore ground, one for VRX pin, and one for VRY pin.</figcaption>
      </figure>
      <div id="intro">
        <h3> Introduction: </h3>
        <p>What did I do for assignment 6? I make the LED responsive to stick movement, and display on webpage! <br> <br>
        For this assignment the requirement was:</p>
        <ul>
          <li>Must use a minimmum of 2 input devices from the Arduino</li>
          <ul>
            <li>Joystick counts as 2-3 inputs</li>
          </ul>
          <li>A minimmum of one output device from the Arudino</li>
          <ul>
            <li>An LED is one output</li>
          </ul>
          <li>Your wedbpage must show interactive, and update based on the input from Arduino</li>
          <li>For code:</li>
          <ul>
            <li>Show a snippet of Javascript</li>
            <li>Show a snippet of Arduino Code</li>
          </ul>
        </ul>
        <p> <br>Based on the requirements above, I choosed a Joystick and LEDs as input and output for the project. I plan to have each colored LEDs represent a direction the Joystick tilted towards. While the White LED represent the serial data receive, it will blink when there is serial data.<br><br>
        <strong><big>Let go in more details belows!</big></strong></p>
      </div>
    </div>

    <div class="row-column">
      <div>
        <h3>Schematic: </h3>
        <p>The following is the schematic of the Fading project which I used: I show them in both physical circuit board via bird-eye-view, and in sketch version. This is what the board look like to allow the function of the Arduino code to run properly. I have one button and one RGB LED which consists of Red, Green, and Blue LEDs. The reason I chose this specific RGB LED is to allow me to perform a color that a single LED couldn't display. As I apply the knowledge I learn in the class's activity, by using the RGB LED to showcase colors combination such as yellow, or pink with fading effects. <br> <br>
        When compare to the physical ciruit, we can see each red wire connect to a pin so the power is drawing individually rather than connected. The red wires on the LEDs side connect to the resistors (each connect individually as well). Then each resistor connect to the LED, and the LED is connect to the ground (in black wire). While on the button side we can see that the button has four legs, and one leg is directly connect to power (5 Volt) and the other leg is connect to a pin, and a resistor. The resistor is also connect to the ground wire (black).
      </p>
      </div>
      <div class="content">
        <div>
          <figure>
            <img src="A6_Circuit_topview.jpg" width="auto" height="300"/>
            <figcaption> Fig2: Showing the circuit boad in bird-eye-view. This image is representing the sketch schematic (image to the right) in  physical circuit board form.</figcaption>
          </figure>
        </div>
        <div>
          <figure>
            <img src="A6_Sketch.jpg" width="auto" height="300"/>
            <figcaption> Fig 3: This image show the Schemaitc of the circuit board via sketching.</figcaption>
          </figure>
        </div>
      </div>
    </div>

    <div class="row-column">
      <div>
        <h4 id="row-content">Resistors: </h4>
        <p id="row-content">Beside the LEDs and the button, there is a component called the resistors, here is the appropriate resistor value for each color LED was calculated as follow:</p>
        <ul>
          <li>...</li>
          <ul>
            <li>...</li>
            <li>...</li>
            <li>...</li>
            <li>...</li>
            <li>...</li>
          </ul>
          <li>...</li>
          <ul>
            <li>...</li>
            <li>...</li>
            <li>...</li>
            <li>...</li>
            <li>...</li>
          </ul>
          <li>...</li>
          <ul>
            <li>...</li>
            <li>...</li>
            <li>...</li>
            <li>...</li>
            <li>...</li>
          </ul>
        </ul>
        <p> ... <br><br>
        ...<br> <br> </p>
      </div>
      <div class="row-column">
        <div>
          <h4 id="row-content">Javascript: </h4>
          <p id="row-content">Beside the LEDs and the button, there is a
      component called the resistors, here is the appropriate resistor value
      for each color LED was calculated as follow:</p>
          <pre>
            // This should match the baud rate in your Arduino sketch
            const BAUD_RATE = 9600;
            // Declare global variables
            let port, connectBtn;
            // declare variable to store previous value of x position
            let pX = 0;
            // declare variable to store previous value of y position
            let pY = 0;
            // This function help setting up the webpage
            function setup() {
              // Run our serial setup function (below)
              setupSerial();

              // Create a canvas that is the size of our browser window.
              // windowWidth and windowHeight are p5 variables
              createCanvas(windowWidth, windowHeight);
              // Creating a stroke like density of 4
              strokeWeight(4);
              // Adding stroke line color to distinct from the blackground
              stroke(rgb(132, 227, 253));
              // p5 text settings. BOLD and CENTER are constants provided by p5.
              // See the "Typography" section in the p5 reference: https://p5js.org/reference/
              textFont("system-ui", 50);
              textStyle(BOLD);
              textAlign(CENTER, CENTER);
            }

            function draw() {
              // Check whether the port is open (see checkPort function below)
              const portIsOpen = checkPort();
              // If the port is not open, exit the draw loop
              if (!portIsOpen) return;
              // Read from the port until the newline
              let str = port.readUntil("\n");
              // If we didn't read anything, return.
              if (str.length == 0) return;
              // Trim whitespace and split on commas
              let arr = str.trim().split(",");

              // Convert each value from analogRead to a number, map it to the joystick range, and round to nearest integer
              // for example of serial passing in: 511, 509, then the value will be convert to the window's range
              const x = round(map(Number(arr[0]), 0, 1023, windowWidth*0.5, windowWidth*0.75));
              const y = round(map(Number(arr[1]), 0, 1023, windowHeight*0.5, windowHeight*0.75));
              // Make the background black
              background(0);
              // text white
              fill(255);
              // the size of the text display
              textSize(20);
              // Display text in order of x value, y value on the following coordinates of the window frame
              text(`${x}, ${y}`, 10, 10, 100, 100);
              // This help creating the line tracker, by loggin the previous position and current position
              console.log(pX);
              // check to see if previous x position is 0 or not
              if(pX == 0){
                // when prior x position is zero, update the position with the current position
                pX = x;
                // when prior y position is zero, update the position with the current position
                pY = y;
              }
              else{
                // when previous x position is not at 0, create a line that track the range of the position is in
                // previous x to current x, previous y to current y
                line(pX, pY, x, y);
                // updatign the previous x position
                pX = x;
                // updating the previous y position
                pY = y;
              }
              // When the Enter key on the keyboard is pressed
              if(keyIsDown(ENTER)){
                // write to the port char 1
                port.write('1');
              }
            }

            // Three helper functions for managing the serial connection.
            // from class example

            function setupSerial() {
              port = createSerial();

              // Check to see if there are any ports we have used previously
              let usedPorts = usedSerialPorts();
              if (usedPorts.length > 0) {
                // If there are ports we've used, open the first one
                port.open(usedPorts[0], BAUD_RATE);
              }

              // create a connect button
              connectBtn = createButton("Connect to Arduino");
              connectBtn.position(5, 5); // Position the button in the top left of the screen.
              connectBtn.mouseClicked(onConnectButtonClicked); // When the button is clicked, run the onConnectButtonClicked function
            }

            function checkPort() {
              if (!port.opened()) {
                // If the port is not open, change button text
                connectBtn.html("Connect to Arduino");
                // Set background to gray
                background("gray");
                return false;
              } else {
                // Otherwise we are connected
                connectBtn.html("Disconnect");
                return true;
              }
            }

            function onConnectButtonClicked() {
              // When the connect button is clicked
              if (!port.opened()) {
                // If the port is not opened, we open it
                port.open(BAUD_RATE);
              } else {
                // Otherwise, we close it!
                port.close();
              }
            }
          </pre>
        </div>
      <div id="column-split">
        <h4 id="row-content"> Firmware Code: </h4>
        <p id="row-content"> As mentioned there is a require function from the Arduino to tell what ... The following is a snippet of the Arduino code: <br> </p>
        <pre id="para-end">
          // Variable that will be connect to a pin on the Arduino
          // unchange variables.
          // this is to define red LED pin
          const int pinR = 2;
          // this is to define yellow LED pin
          const int pinY = 4;
          // this is to define white LED pin
          const int pinW = 7;
          // this is to define green LED pin
          const int pinB = 12;
          // this is to define blue LED pin
          const int pinG = 13;
          // this will define the VRX pin from the joystick connect to the Arduino
          const int x = A1;
          // this will define the VRY pin from the joystick connect to the Arduino
          const int y = A0;

          // Declaring a constant minimum center range, as the joystick x, and y axis tend to land around 509 to 515
          int center_range_min = 500;
          // Declaring a constant maximum center range, as the joystick x, and y axis tend to land around 509 to 515
          int center_range_max = 515;

          // Variable will be change due to input
          // to store value of the x-axis, when analog to the reading of x.
          int xVal = 0;
          // to store value of the y-axis, when analog to the reading of y.
          int yVal = 0;

          // This method help setup the function needed
          void setup() {
            // set pinMode for LEDs:
            // pinMode for Red LED as an output
            pinMode(pinR, OUTPUT);
            // pinMode for Yellow LED as an output
            pinMode(pinY, OUTPUT);
            // pinMode for White LED as an output
            pinMode(pinW, OUTPUT);
            // pinMode for Green LED as an output
            pinMode(pinB, OUTPUT);
            // pinMode for Blue LED as an output
            pinMode(pinG, OUTPUT);

            // Setting up serial communication
            Serial.begin(9600);
            // Set a timeout for parseInt
            Serial.setTimeout(10);

          }

          void loop() {
            // put your main code here, to run repeatedly:
            // check to see if there is serial data
            if (Serial.available() > 0) {
              // read the serial data
              int value = Serial.read();
              // send the value back as raw binary data
              Serial.write(value);
              // Making the White LED blink
              // turn on the White LED when there is data to parse
              digitalWrite(pinW, HIGH);
              // delay the LED on for 300 milliseconds
              delay(300);
              // turn the White LED off after 300 milliseconds
              digitalWrite(pinW, LOW);
            }
            // delaying before moving forward to other code, avoid glitching.
            delay(100);

            // This read the analog X values
            xVal = analogRead(x);
            // This read the analog Y values
            yVal = analogRead(y);

            // Checking for the x and y range:
            // when x value is less than center minimmum range and
            // y value is between the origin range
            // this indicate that the joystick get push towards the left direction
            // When the joystick is tilting to the left, Red LED turn on.
            if (xVal < center_range_min &&
            yVal >= center_range_min && yVal <= center_range_max){
              // turn the Red LED on by setting it as HIGH
              digitalWrite(pinR, HIGH);
              // turn the Yellow LED off by setting it as LOW
              digitalWrite(pinY, LOW);
              // turn the Blue LED off by setting it as LOW
              digitalWrite(pinB, LOW);
              // turn the Green LED off by setting it as LOW
              digitalWrite(pinG, LOW);
            }
            // Checking for the x and y range:
            // when x value is greater than center maximmum range and
            // y value is between the origin range
            // this indicate that the joystick get push in the right direction
            // When the joystick is tilting to the right, Yellow LED turn on.
            else if(xVal > center_range_max &&
            yVal >= center_range_min && yVal <= center_range_max){
              // turn the Yellow LED on by setting it as HIGH
              digitalWrite(pinY, HIGH);
              // turn the Red LED off by setting it as LOW
              digitalWrite(pinR, LOW);
              // turn the Blue LED off by setting it as LOW
              digitalWrite(pinB, LOW);
              // turn the Green LED off by setting it as LOW
              digitalWrite(pinG, LOW);
            }
            // Checking for the x and y range:
            // when y value is greater than center maximmum range and
            // x value is between the origin range
            // this indicate that the joystick get push in the downward direction
            // When the joystick is in the downward direction, Blue LED turn on.
            else if (yVal > center_range_max &&
            xVal >= center_range_min && xVal <= center_range_max){
              // turn the Blue LED on by setting it as HIGH
              digitalWrite(pinB, HIGH);
              // turn the Yellow LED off by setting it as LOW
              digitalWrite(pinY, LOW);
              // turn the Red LED off by setting it as LOW
              digitalWrite(pinR, LOW);
              // turn the Green LED off by setting it as LOW
              digitalWrite(pinG, LOW);
            }
            // Checking for the x and y range:
            // when y value is less than center minimum range and
            // x value is between the origin range
            // this indicate that the joystick get push in the upward direction.
            // When the joystick is in the upward direction, Green LED turn on.
            else if(yVal < center_range_min &&
            xVal >= center_range_min && xVal <= center_range_max){
              // turn the Green LED on by setting it as HIGH
              digitalWrite(pinG, HIGH);
              // turn the Yellow LED off by setting it as LOW
              digitalWrite(pinY, LOW);
              // turn the Blue LED off by setting it as LOW
              digitalWrite(pinB, LOW);
              // turn the Red LED off by setting it as LOW
              digitalWrite(pinR, LOW);
            }
            // turn all LEDs off when the joystick is centered
            else {
              // turn the Green LED off by setting it as LOW
              digitalWrite(pinG, LOW);
              // turn the Yellow LED off by setting it as LOW
              digitalWrite(pinY, LOW);
              // turn the Blue LED off by setting it as LOW
              digitalWrite(pinB, LOW);
              // turn the Red LED off by setting it as LOW
              digitalWrite(pinR, LOW);
            }

            // Print the x value from analogRead() for x position to serial array
            Serial.print(xVal);
            // separating the x and y value
            Serial.print(", ");
            // Print the y value reading from analogRead() for y position to serial array
            Serial.println(yVal);

            // Delaying for 10 millisecond to avoid glitching
            delay(100);

          }
        </pre>
      </div>
    </div>

    <div class="row-column">
      <div class="column">
        <div>
          <figure>
            <h4>Operation: </h4>
            <img src="A6_Operation.gif" width="auto" height="300"/>
            <figcaption>This is an GIF showing the circuit breadboad in operation mode. A short replay clip of what the circuit does. This circuit was built using Arduino, breadboad, LEDs, resistors, and push button from our kit.</figcaption>
          </figure>
        </div>
        <div>
          <h4>Voltage Chart</h4>
          <figure>
          <img src="A6_Graph.jpg" width="auto" height="300"/>
          <figcaption>The image is showing the chart in x-axis is time and the y-axis is voltage. With three lines in differents colors representing the voltage across the LED with analogWrite(led, 64); analogWrite(led, 128); and analogWrite(led, 255). </figcaption>
          </figure>
        </div>
      </div>
      <div>
        <p> <br> The function of the button is to turn off the LEDs when its in operation state. The button will also turn on the LEDs, when the LEDs is in off state. As you can see the LEDs is in operation state at first, and once I push the button (that add up to the count when modulo 2 is no equal 0) its turn off. Then turn back on again when I push on the button. The LEDs function not just light up, but in fact is fading from one color to the next. In this case I set the color from bright yellow fading to white and change from bright white to gainning color to a darker pink/red. <br> <br>
        Although it look quite short and simple, but to perform this I had to use multiple example code from the Arduino IDE: StateChangeDetection code example, and Fading coding example. By manipulate the two code, I was able to have the function above. It was quite trials and errors with the calculation of the push button, eventually I got the gist of it by experimenting the button. When I push the button and counts the number I am at and for every two push it counts one, and once the count gets modulo to 2 and equals to zero the LEDs will turn on, and the LEDs will turn off if not equal to zero.</p>
      </div>
    </div>

  </body>
</html>
